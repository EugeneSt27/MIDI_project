
# MIDI Analysis and Knowledge Graph Project

Проект предназначен для анализа MIDI-файлов: извлечения нот, разметки структуры, определения гармонии, построения векторов признаков и анализа композиции с помощью матрицы сходств и графовых методов.

## Возможности

- Автоматическая разметка MIDI на бары и фразы
- Извлечение нот, time signature, гармонии
- Построение векторов признаков для каждого бара
- Анализ композиции: матрица косинусных сходств, граф inheritance
- Сохранение результатов анализа в CSV

## Pipeline

1. **Вход**: Все MIDI-файлы из `data/raw/`.
2. **Извлечение нот и метаданных**: `extract.py` — функции для получения нот, размера, ключа.
3. **Структурная разметка**: `structure.py` — перевод тиков в биты, группировка битов в бары.
4. **Гармония**: `harmony.py` — определение аккорда для каждого бара.
5. **Извлечение признаков**: `features.py` — построение вектора признаков (pitch, harmony, rhythm, activity).
6. **Анализ**:
    - Матрица косинусных сходств между барами (`similarity_matrix.py`)
    - Построение графа inheritance по сходству (`graph_inheritance.py`)
7. **Сохранение результатов**: CSV-файл с метриками по каждому треку

## Запуск

1. Установите зависимости:
    ```
    pip install -r requirements.txt
    ```
2. Поместите MIDI-файлы в папку `data/raw/`.
3. Запустите анализ:
    ```
    python main.py
    ```
4. Результаты будут сохранены в `results/experiment_metrics.csv`.

## Структура проекта

```
MIDI_project/
├── main.py                 # Основной скрипт анализа
├── requirements.txt        # Зависимости
├── README.md               # Документация
├── data/
│   ├── raw/                # Исходные MIDI-файлы
│   └── annotated/          # Аннотированные MIDI
├── results/
│   └── experiment_metrics.csv # CSV с метриками
└── src/
     ├── config.py           # Параметры анализа
     ├── midi/
     │   ├── extract.py      # Извлечение нот, метаданных
     │   └── io.py           # Загрузка/сохранение
     ├── analysis/
     │   ├── structure.py    # Разметка структуры
     │   ├── harmony.py      # Определение гармонии
     │   ├── features.py     # Векторы признаков
     │   └── similarity/
     │       ├── similarity_matrix.py # Матрица сходств
     │       └── graph_inheritance.py # Графовые методы
```

## Методология

1. MIDI делится на бары по размеру (time signature)
2. Для каждого бара извлекается аккорд
3. Строится вектор признаков (pitch, harmony, rhythm, activity)
4. Анализируется сходство между барами (косинусное сходство)
5. Строится directed graph inheritance по сходству
6. Метрики сохраняются в CSV

## Параметры

Параметры анализа настраиваются в `src/config.py`:
- `SIMILARITY_THRESHOLD`: порог сходства для графа
- `MAX_PARENTS`: максимальное число родителей для inheritance
- `WEIGHTS`: веса признаков для сходства

## Рекомендации по развитию

- Добавить тесты для функций и pipeline
- Реализовать обработку ошибок и логирование
- Добавить визуализацию матриц сходств и графов
- Реализовать кластеризацию и анализ фраз
- Улучшить поддержку сложных размеров и edge-cases

---
Проект — фундамент для анализа MIDI и построения графов знаний. Для расширения возможностей добавьте тесты, визуализацию и новые метрики.
